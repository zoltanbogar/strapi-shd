"use strict";(self.webpackChunksmarthomedoctor_strapi=self.webpackChunksmarthomedoctor_strapi||[]).push([[2812],{25857:(re,T,t)=>{t.r(T),t.d(T,{default:()=>se});var e=t(67294),i=t(68547),S=t(87751),y=t(97132),F=t(67838),x=t(49066),V=t(185),$=t(49656),P=t(23724),O=t(45697),n=t.n(O),Q=t(12028),L=t(11047),E=t(75515),Z=t(550),j=t(47144),D=t(18374),H=t(8934),z=t(51196),J=t.n(z);const A=()=>{const{formatDate:a}=(0,y.useIntl)();return m=>{const o=J()(m),c=a(o,{dateStyle:"long"}),r=a(o,{timeStyle:"medium",hourCycle:"h24"});return`${c}, ${r}`}},G={"entry.create":"Create entry ({model})","entry.update":"Update entry ({model})","entry.delete":"Delete entry ({model})","entry.publish":"Publish entry ({model})","entry.unpublish":"Unpublish entry ({model})","media.create":"Create media","media.update":"Update media","media.delete":"Delete media","media-folder.create":"Create media folder","media-folder.update":"Update media folder","media-folder.delete":"Delete media folder","user.create":"Create user","user.update":"Update user","user.delete":"Delete user","admin.auth.success":"Admin login","admin.logout":"Admin logout","content-type.create":"Create content type","content-type.update":"Update content type","content-type.delete":"Delete content type","component.create":"Create component","component.update":"Update component","component.delete":"Delete component","role.create":"Create role","role.update":"Update role","role.delete":"Delete role","permission.create":"Create permission","permission.update":"Update permission","permission.delete":"Delete permission"},b=a=>G[a]||a,v=({headers:a,rows:d,onOpenModal:m})=>{const{formatMessage:o}=(0,y.useIntl)(),c=A(),r=({type:s,value:u,model:l})=>s==="date"?c(u):s==="action"?o({id:`Settings.permissions.auditLogs.${u}`,defaultMessage:b(u)},{model:l}):u||"-";return e.createElement(Z.p,null,d.map(s=>e.createElement(j.Tr,{key:s.id,...(0,i.onRowClick)({fn:()=>m(s.id)})},a.map(({key:u,name:l,cellFormatter:g})=>e.createElement(D.Td,{key:u},e.createElement(E.Z,{textColor:"neutral800"},r({type:u,value:g?g(s[l]):s[l],model:s.payload?.model})))),e.createElement(D.Td,{...i.stopPropagation},e.createElement(L.k,{justifyContent:"end"},e.createElement(Q.h,{onClick:()=>m(s.id),"aria-label":o({id:"app.component.table.view",defaultMessage:"{target} details"},{target:`${s.action} action`}),noBorder:!0,icon:e.createElement(H.default,null)}))))))};v.defaultProps={rows:[]},v.propTypes={headers:n().array.isRequired,rows:n().array,onOpenModal:n().func.isRequired};const W=v,K=[{name:"action",key:"action",metadatas:{label:{id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"},sortable:!0}},{name:"date",key:"date",metadatas:{label:{id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"},sortable:!0}},{key:"user",name:"user",metadatas:{label:{id:"Settings.permissions.auditLogs.user",defaultMessage:"User"},sortable:!1},cellFormatter:a=>a?a.fullname:""}];var R=t(41580);const C=({pagination:a})=>e.createElement(R.x,{paddingTop:4},e.createElement(L.k,{alignItems:"flex-end",justifyContent:"space-between"},e.createElement(i.PageSizeURLQuery,null),e.createElement(i.PaginationURLQuery,{pagination:a})));C.defaultProps={pagination:{pageCount:0,pageSize:50,total:0}},C.propTypes={pagination:n().shape({page:n().number,pageCount:n().number,pageSize:n().number,total:n().number})};const X=C;var Y=t(42866),w=t(24969),k=t(59946),I=t(2407),q=t(88655),_=t(11276),ee=t(74432);const U=({actionLabel:a,actionName:d})=>e.createElement(L.k,{direction:"column",alignItems:"baseline",gap:1},e.createElement(E.Z,{textColor:"neutral600",variant:"sigma"},a),e.createElement(E.Z,{textColor:"neutral600"},d));U.propTypes={actionLabel:n().string.isRequired,actionName:n().string.isRequired};const h=U,M=({status:a,data:d,formattedDate:m})=>{const{formatMessage:o}=(0,y.useIntl)();if(a==="loading")return e.createElement(L.k,{padding:7,justifyContent:"center",alignItems:"center"},e.createElement(q.a,null,"Loading content..."));const{action:c,user:r,payload:s}=d;return e.createElement(e.Fragment,null,e.createElement(R.x,{marginBottom:3},e.createElement(E.Z,{variant:"delta",id:"title"},o({id:"Settings.permissions.auditLogs.details",defaultMessage:"Log Details"}))),e.createElement(_.r,{gap:4,gridCols:2,paddingTop:4,paddingBottom:4,paddingLeft:6,paddingRight:6,marginBottom:4,background:"neutral100",hasRadius:!0},e.createElement(h,{actionLabel:o({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),actionName:o({id:`Settings.permissions.auditLogs.${c}`,defaultMessage:b(c)},{model:s?.model})}),e.createElement(h,{actionLabel:o({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"}),actionName:m}),e.createElement(h,{actionLabel:o({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),actionName:r?.fullname||"-"}),e.createElement(h,{actionLabel:o({id:"Settings.permissions.auditLogs.userId",defaultMessage:"User ID"}),actionName:r?.id.toString()||"-"})),e.createElement(ee.V,{value:JSON.stringify(s,null,2),disabled:!0,height:(0,i.pxToRem)(150),label:o({id:"Settings.permissions.auditLogs.payload",defaultMessage:"Payload"})}))};M.defaultProps={data:{}},M.propTypes={status:n().oneOf(["idle","loading","error","success"]).isRequired,data:n().shape({action:n().string,date:n().string,payload:n().object,user:n().object}),formattedDate:n().string.isRequired};const te=M,B=({handleClose:a,logId:d})=>{const{get:m}=(0,i.useFetchClient)(),o=(0,i.useNotification)(),c=async g=>{const{data:f}=await m(`/admin/audit-logs/${g}`);if(!f)throw new Error("Audit log not found");return f},{data:r,status:s}=(0,P.useQuery)(["audit-log",d],()=>c(d),{onError(){o({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),a()}}),u=A(),l=r?u(r.date):"";return e.createElement(Y.P,{onClose:a,labelledBy:"title"},e.createElement(w.x,null,e.createElement(I.O,{label:l,id:"title"},e.createElement(I.$,null,l))),e.createElement(k.f,null,e.createElement(te,{status:s,data:r,formattedDate:l})))};B.propTypes={handleClose:n().func.isRequired,logId:n().string.isRequired};const ae=B,ne=()=>{const{formatMessage:a}=(0,y.useIntl)(),d=(0,i.useNotification)(),{allowedActions:{canRead:m}}=(0,i.useRBAC)(S.Z.settings.auditLogs),{get:o}=(0,i.useFetchClient)(),{search:c}=(0,$.useLocation)(),[{query:r},s]=(0,i.useQueryParams)();(0,i.useFocusWhenNavigate)();const u=async({queryKey:p})=>{const oe=p[1],{data:ie}=await o(`/admin/audit-logs${oe}`);return ie},{data:l,isLoading:g}=(0,P.useQuery)(["auditLogs",c],u,{enabled:m,keepPreviousData:!0,retry:!1,staleTime:1e3*10,onError(){d({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),f=a({id:"global.auditLogs",defaultMessage:"Audit Logs"}),N=K.map(p=>({...p,metadatas:{...p.metadatas,label:a(p.metadatas.label)}}));return e.createElement(V.o,{"aria-busy":g},e.createElement(i.SettingsPageTitle,{name:f}),e.createElement(F.T,{title:f,subtitle:a({id:"Settings.permissions.auditLogs.listview.header.subtitle",defaultMessage:"Logs of all the activities that happened in your environment"})}),e.createElement(x.D,{canRead:m},e.createElement(i.DynamicTable,{contentType:"Audit logs",headers:N,rows:l?.results||[],withBulkActions:!0,isLoading:g},e.createElement(W,{headers:N,rows:l?.results||[],onOpenModal:p=>s({id:p})})),e.createElement(X,{pagination:l?.pagination})),r?.id&&e.createElement(ae,{handleClose:()=>s({id:null},"remove"),logId:r.id}))},se=()=>e.createElement(i.CheckPagePermissions,{permissions:S.Z.settings.auditLogs.main},e.createElement(ne,null))}}]);
